import{b as G,e as F,r as b,$ as Q,f as ce,ab as re,h as c,o as x,c as de,L as z,M as U,i as t,j as l,k as e,x as h,t as P,s as B,v as pe,n as W,ac as ue,ad as me,W as fe,ae as be,J as ge,z as _e}from"./index-BP30Yz_m.js";import{C as ke}from"./index-DTWQQqpJ.js";import{l as we,c as he,f as ye,h as ve,g as Ce}from"./fabricPicking-8HIwl1N_.js";import Pe from"./index-DHmRcT7-.js";import"./print-C_l5v2Wu.js";function Se(){const{t:a}=G();return{pageData:F({columnData:[{label:a("wmsPicking.billNo"),prop:"billNo",width:"180",fixed:"left"},{label:a("wmsPicking.materialInfo"),prop:"materialInfo",width:"150",fixed:"left"},{label:a("wmsPicking.styleInfo"),prop:"styleInfo",width:"150"},{label:a("wmsPicking.orderInfo"),prop:"orderInfo",width:"150"},{label:a("wmsPicking.billDate"),prop:"billDate",width:"150"},{label:a("wmsPicking.businessUnitsName"),prop:"businessEntityName",width:"auto"},{label:a("wmsPicking.billStatus"),prop:"billStatus",width:"100"},{label:a("wmsPicking.quantity"),prop:"quantity",width:"100"},{label:a("wmsPicking.stockOutQty"),prop:"pickedQuantity",width:"150"},{label:a("wmsPicking.materialRate"),prop:"situation",width:"100"},{label:a("wmsPicking.pickRate"),prop:"percentage",width:"100"},{label:a("remark"),prop:"remark",width:"180"},{label:a("wmsPicking.createName"),prop:"createName",width:"100"},{label:a("createTime"),prop:"createTime",width:"180"},{label:a("include_disable"),prop:"disable",width:"100"},{label:a("operate"),prop:"operate",width:"200",fixed:"right"}],printData:[{label:a("stockFabric.fabricCode"),prop:"fabricCode",width:"auto"},{label:a("stockFabric.fabricName"),prop:"fabricName",width:"auto"},{label:a("stockFabric.quantity"),prop:"quantity",width:"auto"},{label:a("stockFabric.lot"),prop:"lot",width:"auto"},{label:a("stockFabric.colorName"),prop:"colorName",width:"auto"},{label:a("stockFabric.locationCode"),prop:"locationCode",width:"auto"},{label:a("stockFabric.unitCode"),prop:"unitCode",width:"auto"}]})}}function De(){const a=F({pageSize:10,pageNum:1,billNo:null,disable:0,createId:0}),m=F({list:[],total:0}),n=b(),k=b([]),d=()=>{a.pageNum=1,a.pageSize=10,a.disable=0,a.createId=0},s=()=>{n.value&&(n.value.resetFields(),n.value.clearValidate());for(const r in a)Object.prototype.hasOwnProperty.call(a,r)&&(a[r]=void 0);d(),f()},f=async()=>{const{rows:r,total:g}=await we(a);m.list=r,m.total=g};return{formData:a,loadData:f,searchFormRef:n,resetData:s,tableData:m,reloadData:d,businessTypeList:k,getBusinessTypeAll:async()=>{const{data:r}=await he();k.value=r}}}const y=b([]),A=b();function Ne(a,m){async function n(d){d.id||A.value;const s=y.value.length>0&&y.value.every(g=>g.disable),f=!y.value.length&&d.disable,p=async()=>{await ye({id:d.id}),A.value="",y.value=[],m.$modal.msgSuccess(a("operate_success"))},r=g=>m.$modal.confirm(g).then(p);s?await r(a("delete_tip1")):y.value.length?await r(a("delete_tip2")):f?await r(a("delete_tip4")):await r(a("delete_tip3"))}function k({rowList:d}){y.value=d;const s=d.map(f=>f.id);A.value=s.join(",")}return{deleteHandler:n,select:k,idList:y}}const xe={class:"app-container"},Fe={class:"el-dropdown-link mt6"},ze=Object.assign({name:"FabricPickingHome"},{__name:"index",emits:["toggleClick"],setup(a,{emit:m}){const{t:n}=G(),{proxy:k}=_e(),{pageData:d}=Se(),{formData:s,tableData:f,loadData:p,searchFormRef:r,resetData:g}=De(),{deleteHandler:J,select:K,idList:X}=Ne(n,k),I=b(!0),V=b(Q().loading),$=b(),T=b(),q=F({}),O=b([]);ce(()=>{p()}),re(()=>{g()});const Y=async u=>{await J(u),await p()},L=async(u,i)=>{const w=n(i?"submitOk":"submitBack");await k.$modal.confirm(w),await Z(u),await p()},Z=async({id:u,billStatus:i})=>{await ve({id:u,billStatus:i==="draft"?"approved":"draft"}),fe({type:"success",message:n("operate_success")})},ee=async(u,{id:i})=>{T.value=u,be.loading("正在生成打印预览，请稍后..."),V.value=!1;const{data:w}=await Ce({id:i});Object.assign(q,w),O.value=w.details,await ge(),$.value&&(await $.value[T.value?"print":"PrintAroma"](),V.value=Q().loading)},R=(u,i)=>{te("toggleClick",{name:"addFabricPicking",id:u,type:i})},te=m;return(u,i)=>{const w=c("el-input"),D=c("el-form-item"),S=c("el-col"),j=c("el-checkbox"),_=c("el-button"),E=c("el-row"),ae=c("el-form"),v=c("el-tooltip"),le=c("Finished"),N=c("el-icon"),ne=c("RefreshLeft"),H=c("el-dropdown-item"),oe=c("el-dropdown-menu"),ie=c("el-dropdown"),M=c("el-tag"),se=c("el-progress");return x(),de("div",xe,[z(t(ae,{model:e(s),ref_key:"searchFormRef",ref:r,inline:!0,labelSuffix:":"},{default:l(()=>[t(E,{gutter:20},{default:l(()=>[t(S,{lg:5,sm:12,md:12,xs:24},{default:l(()=>[t(D,{label:e(n)("wmsPicking.billNo"),prop:"billNo"},{default:l(()=>[t(w,{modelValue:e(s).billNo,"onUpdate:modelValue":i[0]||(i[0]=o=>e(s).billNo=o),placeholder:`${e(n)("input")}${e(n)("wmsPicking.billNo")} `,clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),t(S,{lg:5,sm:12,md:12,xs:24},{default:l(()=>[t(D,{label:e(n)("wmsPicking.materialInfo"),prop:"materialInfo"},{default:l(()=>[t(w,{modelValue:e(s).materialInfo,"onUpdate:modelValue":i[1]||(i[1]=o=>e(s).materialInfo=o),placeholder:`${e(n)("input")}${e(n)("wmsPicking.materialInfo")} `,clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),t(S,{lg:6,sm:12,md:12,xs:24},{default:l(()=>[t(D,{label:"",prop:"delFlag"},{default:l(()=>[t(j,{modelValue:e(s).disable,"onUpdate:modelValue":i[2]||(i[2]=o=>e(s).disable=o),onChange:e(p),"true-label":1,"false-label":0,label:e(n)("include_disable"),size:"large"},null,8,["modelValue","onChange","label"]),t(j,{modelValue:e(s).createId,"onUpdate:modelValue":i[3]||(i[3]=o=>e(s).createId=o),onChange:e(p),"true-label":1,"false-label":0,label:e(n)("wmsPicking.personal"),size:"large"},null,8,["modelValue","onChange","label"])]),_:1})]),_:1}),t(S,{lg:5,sm:12,md:12,xs:24},{default:l(()=>[t(D,null,{default:l(()=>[t(_,{type:"primary",icon:"Search",onClick:e(p)},{default:l(()=>[h(P(e(n)("query")),1)]),_:1},8,["onClick"]),t(_,{icon:"Refresh",onClick:e(g)},{default:l(()=>[h(P(e(n)("reset")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),[[U,I.value]]),t(E,{gutter:10,class:"mb10 mt10"},{default:l(()=>[t(S,{span:1.5},{default:l(()=>[t(_,{type:"primary",plain:"",icon:"Plus",onClick:i[4]||(i[4]=o=>R(void 0,!1))},{default:l(()=>[h(P(e(n)("add")),1)]),_:1})]),_:1})]),_:1}),t(ke,{loading:V.value,"hide-summary-list":["orderInfo","styleInfo","situation","percentage","businessEntityName","remark","disable"],onSelect:e(K),onQueryTable:e(p),showSearch:I.value,"onUpdate:showSearch":i[5]||(i[5]=o=>I.value=o),"table-key":"fabricPickingId",onHandleCurrentChange:e(p),total:e(f).total,showMultipleColumn:"",pageSize:e(s).pageSize,"onUpdate:pageSize":i[6]||(i[6]=o=>e(s).pageSize=o),pageNum:e(s).pageNum,"onUpdate:pageNum":i[7]||(i[7]=o=>e(s).pageNum=o),operateWidth:"100px",tableData:e(f).list,columnData:e(d).columnData,showSummary:!0,showOperate:!1,"show-multiple":!1,"show-multiple-column":!0,showPagination:!0},{operateDefault:l(({data:{row:o}})=>[t(v,{class:"box-item",effect:"dark",content:e(n)("check_details"),placement:"top-start"},{default:l(()=>[t(_,{link:"",type:"primary",icon:"View",onClick:C=>R(o.id,!0)},null,8,["onClick"])]),_:2},1032,["content"]),o.billStatus==="draft"?(x(),B(v,{key:0,class:"box-item",effect:"dark",content:e(n)("edit"),placement:"top-start"},{default:l(()=>[t(_,{link:"",type:"primary",icon:"Edit",onClick:C=>R(o.id,!1)},null,8,["onClick"])]),_:2},1032,["content"])):pe("",!0),o.billStatus==="draft"?(x(),B(v,{key:1,class:"box-item",effect:"dark",content:e(n)("submit"),placement:"top-start"},{default:l(()=>[t(_,{link:"",type:"primary",onClick:C=>L(o,1)},{default:l(()=>[t(N,null,{default:l(()=>[t(le)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])):(x(),B(v,{key:2,class:"box-item",effect:"dark",content:e(n)("backSubmit"),placement:"top-start"},{default:l(()=>[t(_,{link:"",type:"primary",onClick:C=>L(o,0)},{default:l(()=>[t(N,null,{default:l(()=>[t(ne)]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["content"])),t(v,{class:"box-item",effect:"dark",content:e(n)("delete"),placement:"top-start"},{default:l(()=>[t(_,{link:"",type:"primary",icon:"Delete",disabled:!!e(X).length,onClick:C=>Y(o)},null,8,["disabled","onClick"])]),_:2},1032,["content"]),t(v,{class:"box-item",effect:"dark",content:e(n)("print"),placement:"top-start"},{default:l(()=>[t(ie,{onCommand:C=>ee(C,o)},{dropdown:l(()=>[t(oe,null,{default:l(()=>[t(H,{command:1},{default:l(()=>[h(P(e(n)("wmsPicking.basic")),1)]),_:1}),t(H,{command:0},{default:l(()=>[h("Aroma")]),_:1})]),_:1})]),default:l(()=>[W("div",Fe,[t(N,null,{default:l(()=>[t(e(ue))]),_:1}),t(N,{class:"el-icon--right"},{default:l(()=>[t(e(me))]),_:1})])]),_:2},1032,["onCommand"])]),_:2},1032,["content"])]),billStatusDefault:l(({data:{row:o}})=>[t(M,{type:o.billStatus==="draft"?"info":"success"},{default:l(()=>[h(P(o.billStatus==="draft"?e(n)("draft"):e(n)("approved")),1)]),_:2},1032,["type"])]),percentageDefault:l(({data:{row:o}})=>[t(se,{"text-inside":!0,"stroke-width":16,percentage:o.percentage},null,8,["percentage"])]),disableDefault:l(({data:{row:o}})=>[t(M,{type:o.disable?"info":"success"},{default:l(()=>[h(P(o.disable?e(n)("disabled"):e(n)("normal")),1)]),_:2},1032,["type"])]),_:1},8,["loading","onSelect","onQueryTable","showSearch","onHandleCurrentChange","total","pageSize","pageNum","tableData","columnData"]),z(W("div",null,[z(t(Pe,{ref_key:"printRef",ref:$,data:e(q),list:O.value,type:T.value,"column-data":e(d).printData},null,8,["data","list","type","column-data"]),[[U,!1]])],512),[[U,!1]])])}}});export{ze as default};
