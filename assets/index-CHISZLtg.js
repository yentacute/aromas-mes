import{b as R,e as L,r as D,W as G,J as oe,ab as se,a1 as ne,h as b,o as w,c as E,i as t,j as i,s as N,k as e,$ as H,x as B,t as O,v as re,F as Y,q as j,I as de}from"./index-BP30Yz_m.js";import{r as Q}from"./verify-D2E6NcQX.js";import{a as ce,g as ue,r as me,b as be,c as pe,d as fe}from"./fabricPicking-8HIwl1N_.js";import{C as ye}from"./index-DTWQQqpJ.js";import ke from"./index-CLTzKP3Q.js";function ge(){const{t:a}=R();return{pageData:L({columnData:[{label:a("stockFabric.fabricCode"),prop:"fabricCode",width:"150",fixed:"left"},{label:a("stockFabric.fabricName"),prop:"fabricName",width:"150",fixed:"left"},{label:a("stockFabric.specification"),prop:"specification",width:"150"},{label:a("stockFabric.component"),prop:"component",width:"150"},{label:a("stockFabric.roll"),prop:"roll",width:"auto"},{label:a("stockFabric.grade"),prop:"grade",width:"auto"},{label:a("stockFabric.quantity"),prop:"quantity",width:"180"},{label:a("stockFabric.inventoryQuantity"),prop:"inventoryQuantity",width:"180"},{label:a("stockFabric.styleNo"),prop:"styleNo",width:"150"},{label:a("stockFabric.lot"),prop:"lot",width:"150"},{label:a("stockFabric.colorName"),prop:"colorName",width:"150"},{label:a("stockFabric.locationCode"),prop:"locationCode",width:"150"},{label:a("stockFabric.containerCode"),prop:"containerCode",width:"180"},{label:a("stockFabric.unitCode"),prop:"unitCode",width:"150"},{label:a("stockFabric.qrcode"),prop:"qrcode",width:"180"},{label:a("operate"),prop:"operate",width:"120",fixed:"right"}],printData:[{label:a("stockFabric.fabricCode"),prop:"fabricCode",width:"auto"},{label:a("stockFabric.fabricName"),prop:"fabricName",width:"auto"},{label:a("stockFabric.quantity"),prop:"quantity",width:"auto"},{label:a("stockFabric.lot"),prop:"lot",width:"auto"},{label:a("stockFabric.colorName"),prop:"colorName",width:"auto"},{label:a("stockFabric.locationCode"),prop:"locationCode",width:"auto"},{label:a("stockFabric.unitCode"),prop:"unitCode",width:"auto"}]})}}function we(){const{t:a}=R(),n=L({billNo:null,billStatus:"draft",billDate:"",materialType:null,handler:null,requiredTime:"",remark:null,businessType:"department",businessEntityId:null,refBillNo:null,wmsFabricPickingEntityDtos:[{rowId:"",id:void 0,stockEntityId:"",arriveItemId:"",qrcode:"",lot:"",roll:"",materialId:"",fabricCode:"",materialColorId:"",quantity:"",unitId:"",styleId:"",remark:""}]}),p=D(),V=L({businessType:Q(a("wmsPicking.sourceType")+a("cannot_empty")),businessEntityId:Q(a("wmsPicking.source")+a("cannot_empty"))}),d=D([]),F=D([]),o=async()=>new Promise(async(u,r)=>{var f;if(!p.value){r(!1);return}try{if(await p.value.validate(),!n.wmsFabricPickingEntityDtos.length)return G.warning(a("stockFabric.fabricName")+a("cannot_empty"));console.log(F.value,77),n.businessEntityName=(f=F.value.find(h=>h.sourceId===n.businessEntityId))==null?void 0:f.sourceName,C(),await ce(n),I(),G({type:"success",message:a("operate_success")}),u(!0)}catch(h){throw r(h),h}}),q=async u=>{if(I(),u){const{data:r}=await ue({id:u});for(let f in r)Object.prototype.hasOwnProperty.call(r,f)&&(n[f]=r[f]);n.wmsFabricPickingEntityDtos=r.details,n.details=void 0}n.createTime=void 0,n.updateTime=void 0,n.createNickName=void 0,n.updateNickName=void 0,n.updateNickName=void 0,await oe()},I=()=>{p.value&&(p.value.resetFields(),p.value.clearValidate());for(let u in n)n[u]=void 0;n.billStatus="draft",n.businessType="department",n.billDate=new Date,n.requiredTime=new Date,n.wmsFabricPickingEntityDtos=[]},T=async()=>{const{msg:u}=await me();n.billNo=u},$=async u=>{const{data:r}=await be({businessType:u});F.value=r},C=()=>{var u;n.wmsFabricPickingEntityDtos=(u=n.wmsFabricPickingEntityDtos)==null?void 0:u.map(r=>({rowId:r.rowId,id:r.id,stockEntityId:r.fabricWarehouseEntityId,arriveItemId:r.fabricArriveEntityId,qrcode:r.qrcode,lot:r.lot,roll:r.roll,materialId:r.fabricId,fabricCode:r.fabricCode,materialColorId:r.colorId,quantity:r.quantity,unitId:r.unitId,styleId:r.styleId,remark:r.remark}))};return{updateFormData:n,updateFormRef:p,updateFormRules:V,submit:o,openHandle:q,wmsFabricPickingEntityDtos:d,getFabricPickingOrder:T,getBusinessUnits:$,businessUnitsList:F,resetForm:I}}const De={class:"app-container"},Ce=Object.assign({name:"AddFabricPicking"},{__name:"index",props:{id:{type:String,required:!0},isDetails:{type:Boolean,default:!1}},emits:["toggleClick"],setup(a,{emit:n}){const p=a,V=n,{t:d}=R(),{pageData:F}=ge(),{updateFormData:o,updateFormRef:q,updateFormRules:I,submit:T,openHandle:$,resetForm:C,wmsFabricPickingEntityDtos:u,getFabricPickingOrder:r,getBusinessUnits:f,businessUnitsList:h}=we(),_=D(!1),P=D(""),A=D([]),M=D([]);se(async()=>{C(),await r(),await J(),await ae(),await f(o.businessType),p.id&&await $(p.id)}),ne(()=>{C()});const J=async()=>{const{data:c}=await pe();A.value=c},z=c=>{var s,y,m;P.value="",(s=o.wmsFabricPickingEntityDtos)==null||s.push(...c),console.log(o,"updateFormData.wmsFabricPickingEntityDtos"),o.wmsFabricPickingEntityDtos=(y=o.wmsFabricPickingEntityDtos)==null?void 0:y.map((k,v)=>({...k,rowId:v+1})),P.value=(m=o.wmsFabricPickingEntityDtos)==null?void 0:m.map(k=>k.fabricWarehouseEntityId).join(",")},K=async c=>{var s;o.wmsFabricPickingEntityDtos.splice(c,1),P.value=(s=o.wmsFabricPickingEntityDtos)==null?void 0:s.map(y=>y.fabricWarehouseEntityId).join(",")},X=()=>{var c;_.value=!0,P.value=(c=o.wmsFabricPickingEntityDtos)==null?void 0:c.map(s=>s.fabricWarehouseEntityId).join(",")},Z=()=>{V("toggleClick",{name:"FabricPickingHome"})},ee=async()=>{await T(),V("toggleClick",{name:"FabricPickingHome"})},ae=async c=>{const{data:s}=await fe();M.value=s};return(c,s)=>{const y=b("el-button"),m=b("el-col"),k=b("el-row"),v=b("el-input"),g=b("el-form-item"),x=b("el-option"),S=b("el-select"),W=b("el-date-picker"),te=b("el-input-number"),le=b("el-tooltip"),ie=b("el-form");return w(),E("div",De,[t(k,{gutter:20,justify:"end",class:"mb10"},{default:i(()=>[t(m,{lg:3,sm:12,md:12,xs:24},{default:i(()=>[a.isDetails?re("",!0):(w(),N(y,{key:0,type:"primary",class:"btn-confirm",loading:e(H)().loading,onClick:ee},{default:i(()=>[B(O(e(d)("confirm")),1)]),_:1},8,["loading"])),t(y,{class:"btn-cancel",onClick:Z},{default:i(()=>[B(O(a.isDetails?e(d)("close"):e(d)("cancel")),1)]),_:1})]),_:1})]),_:1}),t(ie,{ref_key:"updateFormRef",ref:q,"label-position":"left",model:e(o),rules:e(I),"label-suffix":"ï¼š"},{default:i(()=>[t(k,{gutter:20},{default:i(()=>[t(m,{lg:5,sm:12,md:12,xs:24},{default:i(()=>[t(g,{label:e(d)("wmsPicking.billNo"),prop:"billNo"},{default:i(()=>[t(v,{modelValue:e(o).billNo,"onUpdate:modelValue":s[0]||(s[0]=l=>e(o).billNo=l),disabled:"",placeholder:`${e(d)("input")}${e(d)("wmsPicking.billNo")} `},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),t(m,{lg:5,sm:12,md:12,xs:24},{default:i(()=>[t(g,{label:e(d)("wmsPicking.billStatus"),prop:"billStatus"},{default:i(()=>[t(S,{modelValue:e(o).billStatus,"onUpdate:modelValue":s[1]||(s[1]=l=>e(o).billStatus=l),clearable:"",disabled:"",placeholder:`${c.$t("choose")}${c.$t("wmsPicking.billStatus")}`},{default:i(()=>[(w(!0),E(Y,null,j(e(M),l=>(w(),N(x,{key:l.dictValue,label:l.dictLabel,value:l.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),t(m,{lg:5,sm:12,md:12,xs:24},{default:i(()=>[t(g,{label:e(d)("wmsPicking.billDate"),prop:"billDate"},{default:i(()=>[t(W,{clearable:"",disabled:a.isDetails,modelValue:e(o).billDate,"onUpdate:modelValue":s[2]||(s[2]=l=>e(o).billDate=l),type:"Date",format:"YYYY-MM-DD",placeholder:`${c.$t("choose")}${c.$t("wmsPicking.billDate")}`},null,8,["disabled","modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),t(m,{lg:5,sm:12,md:12,xs:24},{default:i(()=>[t(g,{label:e(d)("wmsPicking.handler"),prop:"handler"},{default:i(()=>[t(v,{modelValue:e(o).handler,"onUpdate:modelValue":s[3]||(s[3]=l=>e(o).handler=l),clearable:"",disabled:a.isDetails,placeholder:`${e(d)("input")}${e(d)("wmsPicking.handler")} `},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1}),t(k,{gutter:20},{default:i(()=>[t(m,{lg:5,sm:12,md:12,xs:24},{default:i(()=>[t(g,{label:e(d)("wmsPicking.sourceType"),prop:"businessType"},{default:i(()=>[t(S,{modelValue:e(o).businessType,"onUpdate:modelValue":s[4]||(s[4]=l=>e(o).businessType=l),clearable:"",onChange:e(f),disabled:a.isDetails},{default:i(()=>[(w(!0),E(Y,null,j(e(A),l=>(w(),N(x,{key:l.dictValue,label:l.dictLabel,value:l.dictValue},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange","disabled"])]),_:1},8,["label"])]),_:1}),t(m,{lg:5,sm:12,md:12,xs:24},{default:i(()=>[t(g,{label:e(d)("wmsPicking.source"),prop:"businessEntityId"},{default:i(()=>[t(S,{modelValue:e(o).businessEntityId,"onUpdate:modelValue":s[5]||(s[5]=l=>e(o).businessEntityId=l),clearable:"",disabled:a.isDetails},{default:i(()=>[(w(!0),E(Y,null,j(e(h),l=>(w(),N(x,{key:l.sourceId,label:l.sourceName,value:l.sourceId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"])]),_:1}),t(m,{lg:5,sm:12,md:12,xs:24},{default:i(()=>[t(g,{label:e(d)("wmsPicking.requiredTime"),prop:"requiredTime"},{default:i(()=>[t(W,{clearable:"",disabled:a.isDetails,modelValue:e(o).requiredTime,"onUpdate:modelValue":s[6]||(s[6]=l=>e(o).requiredTime=l),type:"Date",format:"YYYY-MM-DD",placeholder:`${c.$t("choose")}${c.$t("wmsPicking.requiredTime")}`},null,8,["disabled","modelValue","placeholder"])]),_:1},8,["label"])]),_:1}),t(m,{lg:9,sm:12,md:12,xs:24},{default:i(()=>[t(g,{label:e(d)("remark"),prop:"remark"},{default:i(()=>[t(v,{modelValue:e(o).remark,"onUpdate:modelValue":s[7]||(s[7]=l=>e(o).remark=l),clearable:"",disabled:a.isDetails,placeholder:`${e(d)("input")}${e(d)("remark")} `},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["label"])]),_:1})]),_:1}),t(k,{gutter:20,justify:"end",class:"mb10"},{default:i(()=>[t(m,{lg:3,sm:12,md:12,xs:24},{default:i(()=>[t(y,{type:"primary",disabled:a.isDetails,onClick:X},{default:i(()=>[B(O(e(d)("wmsPicking.inventory")),1)]),_:1},8,["disabled"])]),_:1})]),_:1}),t(k,{gutter:20},{default:i(()=>[t(ye,{loading:e(H)().loading,"max-height":350,showSearch:!1,"table-key":"fabricPickingAddId","is-show-tool":!1,operateWidth:"100px",tableData:e(o).wmsFabricPickingEntityDtos,columnData:e(F).columnData,showSummary:!1,showOperate:!1,"show-multiple":!1,"show-multiple-column":!1,showPagination:!1},{quantityDefault:i(({data:{row:l}})=>[t(te,{modelValue:l.quantity,"onUpdate:modelValue":U=>l.quantity=U,modelModifiers:{number:!0},disabled:a.isDetails,min:1,max:l.inventoryQuantity,clearable:"",precision:0,"controls-position":"right"},null,8,["modelValue","onUpdate:modelValue","disabled","max"])]),operateDefault:i(({data:{row:l,$index:U}})=>[t(le,{class:"box-item",effect:"dark",content:e(d)("delete"),placement:"top-start"},{default:i(()=>[t(y,{link:"",type:"primary",icon:"Close",disabled:a.isDetails,onClick:Fe=>K(U)},null,8,["disabled","onClick"])]),_:2},1032,["content"])]),_:1},8,["loading","tableData","columnData"])]),_:1})]),_:1},8,["model","rules"]),t(ke,{modelValue:e(_),"onUpdate:modelValue":s[8]||(s[8]=l=>de(_)?_.value=l:null),eliminateIds:e(P),onSelect:z},null,8,["modelValue","eliminateIds"])])}}});export{Ce as default};
