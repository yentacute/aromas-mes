import{_ as j,b as F,r as m,d as b,e as O,a0 as z,a1 as H,h as i,o as k,c as x,i as t,j as r,k as c,a2 as $,x as _,n as y,F as K,q as P,t as V,O as W,s as G,v as J,H as Q,W as S}from"./index-BP30Yz_m.js";import{S as X,e as Y,o as Z,p as ee}from"./index-BLWGdF-D.js";import"./index-BZLRhA_T.js";import"./verify-D2E6NcQX.js";const se={class:"fullpage"},oe={class:"onekey"},ae={class:"progress-label"},te={class:"progress-label"},re={class:"progress-label"},le=Q({name:"Sumbu"}),ne=Object.assign(le,{setup(de){const{t:n}=F(),I=m(null),d=m({userId:b().id,areaType:1,startCode:"",endCode:""}),q=O({startCode:[{required:!0,message:n("required")}],endCode:[{required:!0,message:n("required")}]}),f=m(!1);let T="";const w=a=>{T=a,f.value=!0},B=a=>{f.value=!1,a&&(d.value[T]=a.locationCode)},D=async()=>{await I.value.validate();const{data:a}=await Y(d.value),e=a[0];if((e==null?void 0:e.taskStatus)==="executing"){l.value=[{taskCode:e.taskCode,eventType:"executing",taskType:e.taskType,taskStatus:e.taskStatus,progress:[0,0]}],U(),E(),S({message:n("success"),type:"success"});return}S({message:n(taskStatus),type:"error"})};let u=null;const l=m([]),A=m({0:"任务开始",33:"到达起点(取得容器)",66:"到达终点(放下容器)",100:"任务完成"}),C=async a=>{const{data:e}=await Z({userId:b().id,areaType:1,taskType:a||0,workstationCode:localStorage.getItem("settingBelongId")});e&&Array.isArray(e)&&(e.forEach(s=>{s.progress||(s.progress=[0,0]),s.eventType==="tote_load"&&(s.progress=[0,33]),s.eventType==="tote_unload"&&(s.progress=[0,66]),s.eventType==="task"&&(s.progress=[0,100])}),l.value=[...l.value,...e],console.log(l.value),S({message:n("success"),type:"success"}),U(),E())},U=()=>{u&&clearInterval(u),u=setInterval(async()=>{const{data:a}=await ee({userId:b().id,codes:l.value.map(e=>e.taskCode).toString()});a&&Array.isArray(a)&&l.value.forEach(e=>{const s=a.find(v=>v.taskCode===e.taskCode);(s==null?void 0:s.eventType)==="executing"&&e.progress[1]<1&&(e.progress[1]=1),(s==null?void 0:s.eventType)==="tote_load"&&e.progress[1]<34&&(e.progress[1]=34),(s==null?void 0:s.eventType)==="tote_unload"&&e.progress[1]<67&&(e.progress[1]=67),(s==null?void 0:s.eventType)==="task"&&e.progress[1]<100&&(e.progress[1]=100)})},3e3)};let p=null;const E=()=>{p&&clearInterval(p),p=setInterval(()=>{l.value.forEach(a=>{a.progress||(a.progress=[0,0]);let e=32;a.eventType==="tote_load"&&(e=65),a.eventType==="tote_unload"&&(e=99),a.eventType==="task"&&(e=100),a.progress[1]<e&&a.progress[1]++})},1e3)};return z(()=>{console.log("onUnmounted"),u&&clearInterval(u),p&&clearInterval(p)}),H(()=>{console.log("onDeactivated"),u&&clearInterval(u),p&&clearInterval(p)}),(a,e)=>{const s=i("el-input"),v=i("el-form-item"),g=i("el-button"),L=i("el-form"),N=i("el-divider"),M=i("el-slider"),R=i("el-dialog");return k(),x("div",se,[t(L,{class:"form",ref_key:"formRef",ref:I,model:d.value,rules:c(q),inline:""},{default:r(()=>[t(v,{label:c(n)("sumbu.startCode"),prop:"startCode"},{default:r(()=>[t(s,{modelValue:d.value.startCode,"onUpdate:modelValue":e[0]||(e[0]=o=>d.value.startCode=o),placeholder:" ",clearable:"","prefix-icon":c($),onClick:e[1]||(e[1]=o=>w("startCode"))},null,8,["modelValue","prefix-icon"])]),_:1},8,["label"]),t(v,{label:c(n)("sumbu.endCode"),prop:"endCode"},{default:r(()=>[t(s,{modelValue:d.value.endCode,"onUpdate:modelValue":e[2]||(e[2]=o=>d.value.endCode=o),placeholder:" ",clearable:"","prefix-icon":c($),onClick:e[3]||(e[3]=o=>w("endCode"))},null,8,["modelValue","prefix-icon"])]),_:1},8,["label"]),t(v,null,{default:r(()=>[t(g,{type:"primary",onClick:D},{default:r(()=>[_("执行")]),_:1}),t(g,{type:"primary",onClick:e[4]||(e[4]=o=>C("1"))},{default:r(()=>[_("空托盘补位")]),_:1}),t(g,{type:"primary",onClick:e[5]||(e[5]=o=>C("2"))},{default:r(()=>[_("空托盘补位")]),_:1}),t(g,{type:"primary",onClick:e[6]||(e[6]=o=>C("3"))},{default:r(()=>[_("空托盘补位")]),_:1})]),_:1})]),_:1},8,["model","rules"]),t(N,{style:{margin:"0"}}),y("div",oe,[t(g,{type:"primary",onClick:e[7]||(e[7]=o=>C("0"))},{default:r(()=>[_("一键呼叫")]),_:1})]),(k(!0),x(K,null,P(l.value,o=>(k(),x("div",{class:"progress",key:o.taskCode},[y("div",ae,V(o.taskType),1),y("div",te,V(o.startLocation),1),y("div",{class:W(["progress-slider",{"progress-success":o.taskStatus==="success","progress-suspend":o.taskStatus==="suspend","progress-cancel":o.taskStatus==="cancel","progress-fail":o.taskStatus==="fail"}])},[t(M,{modelValue:o.progress,"onUpdate:modelValue":h=>o.progress=h,"show-tooltip":!1,min:0,max:100,range:"",marks:A.value},null,8,["modelValue","onUpdate:modelValue","marks"])],2),y("div",re,V(o.endLocation),1)]))),128)),f.value?(k(),G(R,{key:0,modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=o=>f.value=o),title:"地图选起止",width:"1024",draggable:""},{default:r(()=>[t(c(X),{type:1,onConfirmCallback:B})]),_:1},8,["modelValue"])):J("",!0)])}}}),fe=j(ne,[["__scopeId","data-v-ea275428"]]);export{fe as default};
